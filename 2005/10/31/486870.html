<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/31/486870.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>To Ex or not to Ex? THAT is the question.</title></head><body>
<h1>To Ex or not to Ex? THAT is the question.</h1>
<p><em>by Michael S. Kaplan, published on 2005/10/31 00:01 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2005/10/31/486870.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma><EM>(Although the title may suggest it to some people, this is not a post about whether I should be giving my ex-girlfriend a call; it is not!)</EM></FONT></P>
<P><FONT face=Tahoma>There are many functions in the Windows API set that have Ex or Ex-style varations that get added.</FONT></P>
<P><FONT face=Tahoma>In lots of cases, the Ex version acts as extension, and extends the functionality of the original function. But in some cases it is simply one that changes the functionality in a particular way.</FONT></P>
<P><FONT face=Tahoma>So it is important </FONT><FONT face=Tahoma>not to try to pick the one to call by assuming that the old function just calls the new one.</FONT></P>
<P><FONT face=Tahoma>Sometimes such an assumption will work --&nbsp;<A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_5yd0.asp">TextOutW</A> basically just calls <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_2ks4.asp">ExtTextOutW</A>, and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/introductiontoresources/resourcereference/resourcefunctions/findresource.asp">FindResourceW</A> does little more than call <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/introductiontoresources/resourcereference/resourcefunctions/findresourceex.asp">FindResourceExW</A>. And in most cases on NT platforms the "A" functions convert and call their "W" equivalents.</FONT></P>
<P><FONT face=Tahoma>But other times, it will not -- <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/tounicode.asp">ToUnicode</A> and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/userinput/keyboardinput/keyboardinputreference/keyboardinputfunctions/tounicodeex.asp">ToUnicodeEx</A>&nbsp;actually both call the same internal&nbsp;function and thus all you get for trying to short circuit what appears to be the wrapper is that you push an extra 4-8 bytes of stack.</FONT></P>
<P><FONT face=Tahoma>The code for the Unicode and ANSI versions of <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/charnext.asp">CharNext</A>&nbsp;are entirely different bits of code, trying to solve entirely different kinds of issues. You will actually cause more problems than you solve by trying to convert yourself and calling one of them.</FONT></P>
<P><FONT face=Tahoma>And many people feel like you need a spirit dancer, a <A href="http://8ball.ofb.net/">Magic 8-Ball</A> and a&nbsp;ouija board if you want to know the difference between <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_9rzo.asp">GetTextExtentPoint</A>,&nbsp;<A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_8smq.asp">GetTextExtentPoint32</A>&nbsp;and <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_15kk.asp">GetTextExtentExPoint</A>, or between the <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_2ynn.asp">EnumFonts</A>, <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_2z03.asp">EnumFontFamilies</A>, and <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_4mk8.asp">EnumFontFamiliesEx</A>&nbsp;functions. Every time you think you get a handle on the differences in the Platform SDK documentation, a topic like <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_7xpv.asp">this one</A>&nbsp;or <A href="http://msdn.microsoft.com/library/en-us/gdi/fontext_9r77.asp">this one</A> makes you start wondering again.</FONT></P>
<P><FONT face=Tahoma>Now on top of all that,&nbsp;</FONT><FONT face=Tahoma>in a particular very special case, the Ex version is actually a wrapper around the non-Ex version.</FONT></P>
<P><FONT face=Tahoma>That case is <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypea.asp">GetStringTypeA</A>, <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypew.asp">GetStringTypeW</A>, and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypeex.asp">GetStringTypeEx</A>, the main subjects of this post.</FONT></P>
<P><FONT face=Tahoma>These three functions have an interesting, some would say the professional&nbsp;equivalent of sordid,&nbsp;history.</FONT></P>
<P><FONT face=Tahoma>You see, there is no GetStringType function in the documentation or the header files, because the decorated functions (<A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypea.asp">GetStringTypeA</A>&nbsp;and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypew.asp">GetStringTypeW</A>) take different parameters -- the former takes an LCID and the latter does not.</FONT></P>
<P><FONT face=Tahoma>The&nbsp;story varies when asking oldtimers about how this all came about.</FONT></P>
<P><FONT face=Tahoma>Perhaps more will chime in, ones without bias especially welcome -- bias clearly is what makes so many people have such different recollections!</FONT></P>
<P><FONT face=Tahoma>But the most consistent story I have been able to glean from various sources is that&nbsp;<A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypew.asp">GetStringTypeW</A>&nbsp;was done by the NT team for NT 3.1 and <A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypea.asp">GetStringTypeA</A>&nbsp;was done by the Win9x team for Win95. Now NT 3.1 shipped first, and it was only when the Win95 project hit this bit of code that the need for an LCID became obvious. The NT team could not change&nbsp;their function signature and the 9x team could not proceed without a context for the conversion, so they split the difference and kept them separate, and Win95/NT 3.5 both shipped with the&nbsp;<A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypeex.asp">GetStringTypeEx</A>&nbsp;function.</FONT></P>
<P><FONT face=Tahoma><EM>(No one could recall if NT 3.1 ever was supposed to support a GetStringTypeA that had no LCID parameter, but I have checked the NT&nbsp;3.1 kernel32.dll&nbsp;and it did not export&nbsp;such a function&nbsp;(the NT 3.5 version matches the current function, as the documentation indicates). One person hypothesized that the Win9x issue came up in time to yank out the LCID-less GetStringTypeA but too late to change GetStringTypeW, but admitted that this was pure guessing!)</EM></FONT></P>
<P><FONT face=Tahoma>Now, looking at all of the functions to explain what they do:</FONT></P>
<UL>
<LI><A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypew.asp"><FONT face=Tahoma>GetStringTypeW</FONT></A><FONT face=Tahoma>&nbsp;- looks up the data on all of the characters in the string and returns it;</FONT> 
<LI><A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypea.asp"><FONT face=Tahoma>GetStringTypeA</FONT></A><FONT face=Tahoma>&nbsp;- uses the locale to get the codepage to convert with, allocates a buffer for the Unicode string, converts the string to Unicode, calls GetStringTypeW, frees up the buffer;</FONT> 
<LI><A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypeex.asp"><FONT face=Tahoma>GetStringTypeEx</FONT></A><FONT face=Tahoma>&nbsp;'W' version - uses the locale to verify that it is valid, then calls GetStringTypeW</FONT> 
<LI><FONT face=Tahoma><A href="http://msdn.microsoft.com/library/en-us/winui/winui/windowsuserinterface/resources/strings/stringreference/stringfunctions/getstringtypeex.asp"><FONT face=Tahoma>GetStringTypeEx</FONT></A><FONT face=Tahoma>&nbsp;</FONT>'A' version -&nbsp;calls GetStringTypeA (see above for steps).</FONT></LI></UL>
<P><FONT face=Tahoma>Now 'uses the locale' means looking it up in our list of 'loaded' locales, an if it is not there, loading it and adding it to that list. Maybe GetStringTypeExW could have skipped looking at the locale (since it does not use it) but it was not written that way originally (at this point who knows what kind of dependencies might be in customer code, so <a href="http://archives.miloush.net/michkap/archive/2005/03/06/386194.html">we can't change the behavior</A>.</FONT></P>
<P><FONT face=Tahoma>Notice what happened here&nbsp;though -- GetStringTypeW (which technically came first) is the main function, and the other two that came later are the wrappers that are doing extra work just to call the original function. The other functions provide no additional funtionality unless you want to consider it as a confusing way to get <A href="http://msdn.microsoft.com/library/en-us/intl/nls_74dh.asp">IsValidLocale</A>-esque functionality (which seems crazy, but is the reason we can't take out the behavior, unfortunately).</FONT></P>
<P><FONT face=Tahoma>So, the answer to the original question "To Ex or not to Ex?" in this case is (ironically enough, just as with the ex-girlfriend?)&nbsp;probably not to Ex. And for the wider question, it is probably better to decide based on the functionality you need and not on which one looks newer, unless you have someone writing&nbsp;a blog entry to explain why you might want to do something different.</FONT></P>
<P><FONT face=Tahoma>And how often does that really happen, anyway? :-)</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>Â¿</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/00bf">U+00bf</A>, INVERTED QUESTION MARK)</EM></FONT></P>
<hr/><p><a id="487172" href="#487172">#</a> <strong>PatriotB</strong> on Monday, October 31, 2005 4:07 AM:</p><div style="margin-left: 1em">There's even some ExEx functions out there.  The COM folks had the right idea with using a number at the end...</div>
<p><a id="487209" href="#487209">#</a> <strong>Michael S. Kaplan</strong> on Monday, October 31, 2005 7:20 AM:</p><div style="margin-left: 1em">I kind of like ExEx -- it puts it all in perspective. :-)</div>
<p><a id="487281" href="#487281">#</a> <strong>Skywing</strong> on Monday, October 31, 2005 11:19 AM:</p><div style="margin-left: 1em">I always thought it was silly to release &quot;Ex&quot; and &quot;plain&quot; versions of functions at the same time.<br><br>For instance, consider VirtualAlloc/VirtualAllocEx and WaitForSingleObject/WaitForSingleObjectEx - as far as I know they have both always existed, and the non-Ex functions just provide the C equivalent of a default argument.</div>
<p><a id="487282" href="#487282">#</a> <strong>Michael S. Kaplan</strong> on Monday, October 31, 2005 11:21 AM:</p><div style="margin-left: 1em">That is not so bad, Skywing -- the 'Ex' does not always mean for a future version; sometimes it is just extended functionality.</div>
<p><a id="487368" href="#487368">#</a> <strong>Vorn</strong> on Monday, October 31, 2005 2:05 PM:</p><div style="margin-left: 1em">Perhaps you should call your ex-girlfriend anyway. :)<br><br>I don't get it - why on earth is there an ex version of GetStringTypeA if it does nothing extra?<br><br>Vorn</div>
<p><a id="487523" href="#487523">#</a> <strong>Michael S. Kaplan</strong> on Monday, October 31, 2005 9:07 PM:</p><div style="margin-left: 1em">No way, Vorn -- some wounds are best not picked at. :-) As to why -- so it could be like every other Win32 API function with &quot;W&quot; and &quot;A&quot; versions and can be doc'ed as GetStringTypeEx.</div>
<p><a id="508042" href="#508042">#</a> <strong>Yuhong Bao</strong> on Thursday, December 29, 2005 3:12 PM:</p><div style="margin-left: 1em">How about including definations like this in Windows.h or any header file that is included in it:<br>#ifdef UNICODE<br>#define GetStringType(Locale, dwInfoType, lpSrcStr, cchSrc, lpCharType) GetStringTypeW(dwInfoType, lpSrcStr, cchSrc, lpCharType)<br>#else<br>#define GetStringType(Locale, dwInfoType, lpSrcStr, cchSrc, lpCharType) GetStringTypeA(Locale, dwInfoType, lpSrcStr, cchSrc, lpCharType)<br>#endif</div>
<p><a id="508047" href="#508047">#</a> <strong>Michael S. Kaplan</strong> on Thursday, December 29, 2005 3:19 PM:</p><div style="margin-left: 1em">Personally I think this would have been okay, but people are (apparently) very sensitive about dropping parameters on Win32 API function calls....</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/04/05 <a href="http://archives.miloush.net/michkap/archive/2012/04/05/10290985.html">WideCharToMultiByte vs. DrawTextW? In tennis terms, 15-Love!</a></p><p>2010/11/08 <a href="http://archives.miloush.net/michkap/archive/2010/11/08/10087179.html">Header files are the wrong place to be less than helpful</a></p><p>2008/12/08 <a href="http://archives.miloush.net/michkap/archive/2008/12/08/9183280.html">Lt is TC (and TC is Title Case, or Total Crap -- take your pick!)</a></p><p>2008/07/26 <a href="http://archives.miloush.net/michkap/archive/2008/07/26/8776572.html">Don't sneak a BOM in on someone who promises to ignore free space</a></p><p>2007/07/15 <a href="http://archives.miloush.net/michkap/archive/2007/07/15/3888681.html">Neutral? I do not think that word means what you think it means!</a></p><p>2007/06/11 <a href="http://archives.miloush.net/michkap/archive/2007/06/11/3230072.html">The difference between C1_SPACE-ing out and drawing a C1_BLANK</a></p><p>2006/10/07 <a href="http://archives.miloush.net/michkap/archive/2006/10/07/801030.html">GetStringTypeW almost understands the Bidirectional Algorithm</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2005/10/31/487292.html" title="Heading off to the UTC...">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2005/10/30/487109.html" title="Julie Bennet is on Charmed!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2005-10-31">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2005/10/31/486870.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>