<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/12/02/273619.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>Get off my [lower] case! (or: Casing, the 1st)</title></head><body>
<h1>Get off my [lower] case! (or: Casing, the 1st)</h1>
<p><em>by Michael S. Kaplan, published on 2004/12/02 00:01 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2004/12/02/273619.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<BLOCKQUOTE dir=ltr>
<BLOCKQUOTE dir=ltr>
<P><EM>"Trying a case the second time is like eating yesterday morning’s oatmeal." -- Lloyd Paul Stryker</EM></P></BLOCKQUOTE></BLOCKQUOTE>
<P>Of course when Stryker said this, he was referring to legal jurisprudence. But believe it or not, the quote can be just as applicable to alphabetical casing operations!</P>
<P>For reasons that surpass my understanding, there are many developers who run code that uppercases&nbsp;a lowercasing operation or vice versa as a way of making sure that any one-way mappings are taken out of the equation. They usually do this to try to match the NTFS filesystem, which does not seem to them to have any problems with one-way mappings. Which is just a little bit dumb, since the filesystem works by simple uppercasing. Because of that, the only true one-way mappings that cause these developers to have different behavior in their code are the lowercasing ones.</P>
<P>The problem is most&nbsp;acute in&nbsp;one particular situation (one that seems to come up frequently when people combine the above incorrect technique with extensive test passes).&nbsp;Basically, the issue is that Georgian has spent many years in <A title="the Unicode Standard" href="http://www.unicode.org/" target=_blank>the Unicode Standard</A> with two scripts encoded, despite the fact that there are three scripts existing. As of Unicode 4.1, the plan is to finally add that third script and provide a two-way case mapping between the two older scripts (the uppercase Khutsuri and the <EM>new</EM> lowercase Nushkuri), leaving the modern (Mkhedruli) script completely caseless. </P>
<P>Now Mkhedruli has always been caseless according to Unicode so they are fine. We at Microsoft are not so fortunate, because ever since Windows 2000, Microsoft has had a one-way mapping from uppercase Khutsuri to Mkhedruli, but no converse mapping from the caseless Mkhedruli to Khutsuri. No worries for NTFS (which only uppercases), but for those developers who run through two casing operations will get incorrect results back.</P>
<P>(Obviously, removing the bogus mapping some time between now and when we have to do the new mapping for Unicode 4.1 would be a good thing, for both Windows and the .NET Framework. More on that when I know more....)</P>
<P>The moral of the story? If you want to mimic the filesystem, then skip the step that the filesystem skips -- no lowercasing!</P>
<P><EM>Future "casing" columns will talk about other fun and un-fun casing factoids, issues, problems, and features in Windows and the .NET Framework.</EM></P>
<hr/><p><a id="273712" href="#273712">#</a> <strong>Eusebio Rufian-Zilbermann</strong> on Thursday, December 02, 2004 6:44 AM:</p><div style="margin-left: 1em">Very interesting. Yesterday I was trying to explain why upper/lowercasing operations are a bad idea and better avoided whenever possible. Now I can add Georgian to the list of reasons, along with Turkish dotted I's :)</div>
<p><a id="329460" href="#329460">#</a> <strong>Norman Diamond</strong> on Tuesday, December 21, 2004 7:02 PM:</p><div style="margin-left: 1em">NTFS only does uppercasing?  Which uppercasing?  If I understand correctly, the question of whether e with acute accent uppercases to plain E or to E with acute accent depends on the country where the uppercasing is performed.  Is it possible to transport a hard disk from one country to another?  Or to share it across an international network?  What happens to the uppercased filenames?</div>
<p><a id="329596" href="#329596">#</a> <strong>Michael Kaplan</strong> on Tuesday, December 21, 2004 10:07 PM:</p><div style="margin-left: 1em">I am only dealing with casing of Unicode characters, as defined the Microsoft casing tables. As I point out in another post, if the &quot;linguistic casing&quot; flag is not passed then no one-way mappings are seen anyway.<br><br>But the case mapping info is stored with the hard drive format operation, so even future casing table changes would not impact this....</div>
<p><a id="329646" href="#329646">#</a> <strong>Norman Diamond</strong> on Tuesday, December 21, 2004 11:48 PM:</p><div style="margin-left: 1em">12/21/2004 10:07 PM Michael Kaplan<br><br>&gt; As I point out in another post<br><br>Sorry I didn't see it yet.<br><br>&gt; case mapping info is stored with the hard<br>&gt; drive format operation<br><br>Hmm.  Then if a USB hard drive is formatted by a system running Windows XP under one country's locale and then attached to a system running Windows XP under a different country's locale, that NTFS partition keeps its filenames reliably.  I'd like to make a few comparisons.<br><br>Under Windows NT4 and 9x, if a filename had been written by a German system it might be inaccessible by a Japanese system and vice-versa.  It was possible for each system to write files to the same partition, and then no version of Windows Explorer would be able to delete all of the filenames and no version of Scandisk would be able to adjust (sometimes called &quot;fix&quot;) all of the filenames.  Actually this could also happen just between US and Japanese, since US Windows installers created filenames containing a single-byte character that looks roughly like &quot;1/2&quot;.  But I mostly saw that in FAT.<br><br>I guess you're saying that if NTFS were used, then sometimes it would not be possible for an executing Windows system to create a file in its own language, because the stored mapping information would prevent it.  But you're not quite saying that, because my experience is with different language characters and here we should only be talking about different casing rules.  But even when it's casing, I guess you're saying that sometimes an executing Windows system will be unable to create a file in its own national version of a language, for example a filename containing E accent acute when the NTFS partition had been formatted under a locale that doesn't accent capital vowels.<br><br>What happens when a network is involved?  I've seen clients create files in network shares using the code page of the client instead of the server, and then the server can't access its own file.  With NTFS this would be impossible?  Or only when it's a casing issue it would be impossible?</div>
<p><a id="329655" href="#329655">#</a> <strong>Michael Kaplan</strong> on Wednesday, December 22, 2004 12:02 AM:</p><div style="margin-left: 1em">No, you have misunderstood.<br><br>I am referring to NT-based platforms, and to NTFS. <br><br>Different machines with different locale settings will not get different results. Its the same casing table. Thus there is no issue with locale-specific behavior as there is no locale-specific casing on Windows other than the Turkic casing rules, which are never applied to NT filesystems.</div>
<p><a id="330182" href="#330182">#</a> <strong>Norman Diamond</strong> on Wednesday, December 22, 2004 1:44 PM:</p><div style="margin-left: 1em">&gt; I am referring to NT-based platforms<br><br>So was I when mentioning XP and NT4.  Sorry I mentioned 9x one time.  Sorry I mentioned FAT one time too.<br><br>&gt; different locale settings will not get<br>&gt; different results<br><br>Then my previous questions revive.  When e accent acute is uppercased in some countries it becomes E accent acute but in some countries it becomes plain E.  Which uppercasing does NTFS do?  And whichever it does, is the resulting file accessible when the disk is moved or shared to a machine whose locale does the other kind of uppercasing?  But, umm...<br><br>&gt; there is no locale-specific casing on<br>&gt; Windows other than the Turkic<br><br>Then how do you contend with national variants of French etc.?</div>
<p><a id="330189" href="#330189">#</a> <strong>Michael Kaplan</strong> on Wednesday, December 22, 2004 1:50 PM:</p><div style="margin-left: 1em">How I do contend with national variants ofr French casing *personally*?  I don't.<br><br>Windows does not, either. See my post from the next day that talks about the so-called &quot;linguistic&quot; results, which is where this sort of thing might go if it were in there.<br><br>But its not there, so its not an issue.<br><br>Of course anyone is free to create a filesystem that is incompatible with changes in user or system settings.... but I will stick with NTFS.</div>
<p><a id="331544" href="#331544">#</a> <strong>Norman Diamond</strong> on Thursday, December 23, 2004 5:28 PM:</p><div style="margin-left: 1em">&gt; How I do contend with national variants ofr<br>&gt; French casing *personally*?<br><br>I meant how does Microsoft make Windows contend with them.<br><br>&gt; Windows does not, either. See my post from<br>&gt; the next day<br><br>OK I read it now.  (Hadn't read it before because, although aware of Turkish, I hadn't needed to worry about it, though was glad that Windows contended with it.)<br><br>I think I do see the answer in that posting.  You have cases where Windows sometimes doesn't boot.  So I guess that in varying French locales, although (I guess) problems will not be as severe as failing to boot, the answer is that Windows will have problems.<br><br>&gt; I will stick with NTFS<br><br>Sure.  So if a program running under one locale uppercases a filename and creates that file in NTFS, and then a program running under a slightly different locale uppercases the same filename to a different result and then can't open the file, tough.  I'm a bit surprised, but I understand.<br><br>In order to find the answer to one of my questions (when NTFS uppercases a filename does e accent acute convert to E accent acute or does it convert to plain E), I guess I'll have to do some experimenting.</div>
<p><a id="331576" href="#331576">#</a> <strong>Michael Kaplan</strong> on Thursday, December 23, 2004 7:18 PM:</p><div style="margin-left: 1em">No need to try -- NTFS does not handle this case, nor does Windows. If there is an acute in one, the acute stays in the other, in all locales.</div>
<p><a id="331596" href="#331596">#</a> <strong>Norman Diamond</strong> on Thursday, December 23, 2004 7:57 PM:</p><div style="margin-left: 1em">&gt; nor does Windows<br><br>You mean that e accent acute uppercases to E accent acute even in locales for French in countries that don't use accents on uppercase letters?  Don't you get complaints from those countries?</div>
<p><a id="331607" href="#331607">#</a> <strong>Michael Kaplan</strong> on Thursday, December 23, 2004 8:19 PM:</p><div style="margin-left: 1em">Yes, that is what I mean. And no, we do not get complaints, either in France or Canada (of the two Canada has a more active community of peeople looking at standards).</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2006/03/12 <a href="http://archives.miloush.net/michkap/archive/2006/03/12/549951.html">Traditional versus modern sorts</a></p><p>2005/09/13 <a href="http://archives.miloush.net/michkap/archive/2005/09/13/464416.html">The Is* Unicode script ranges in .NET's RegEx</a></p><p>2005/08/20 <a href="http://archives.miloush.net/michkap/archive/2005/08/20/454071.html">New in Vista Beta 1: Updated OS casing tables</a></p><p>2005/06/24 <a href="http://archives.miloush.net/michkap/archive/2005/06/24/432121.html">LCMapString's *other* job</a></p><p>2005/06/02 <a href="http://archives.miloush.net/michkap/archive/2005/06/02/424128.html">The New String recommendations</a></p><p>2005/05/08 <a href="http://archives.miloush.net/michkap/archive/2005/05/08/415522.html">Similar descriptions does not mean similar methodologies</a></p><p>2005/04/26 <a href="http://archives.miloush.net/michkap/archive/2005/04/26/412079.html">Intelligent unmanaged string comparison</a></p><p>2005/04/04 <a href="http://archives.miloush.net/michkap/archive/2005/04/04/405174.html">When casing does not need to roundtrip in .NET</a></p><p>2005/01/16 <a href="http://archives.miloush.net/michkap/archive/2005/01/16/354210.html">My apparent obsession with "case" puns</a></p><p>2005/01/16 <a href="http://archives.miloush.net/michkap/archive/2005/01/16/353873.html">How [case-]insensitive (apologies to Frank Sinatra)</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2004/12/03/274288.html" title="The [Upper]Case of the Turkish İ (or: Casing, the 2nd)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2004/12/01/272864.html" title="Crossing the &lt;b>DIGIT&lt;/b>al divide...">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-12">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2004-12-02">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2004/12/02/273619.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:42 GMT -->
</html>