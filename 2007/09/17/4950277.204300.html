<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/17/4950277.204300.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>The torrents of U+fffd (aka When security and conformance trump compatibility and reality)</title></head><body>
<h1>The torrents of U+fffd (aka When security and conformance trump compatibility and reality)</h1>
<p><em>by Michael S. Kaplan, published on 2007/09/17 00:01 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2007/09/17/4950277.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><EM>(The purpose for the characters below should be apparent presently!)</EM></P>
<P><A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>&nbsp;U+fffd<EM>&nbsp;</EM></P>
<P><EM>This post&nbsp;is my personal opinion and I am not speaking officially on behalf of my current team, my former team, the executive staff of Microsoft, or&nbsp;anyone in&nbsp;between. They may agree with me, they may not, and if you want the quote from any of them, you'll have to ask them. You have been warned!</EM></P>
<P>Remember when I posted <A class="" href="http://archives.miloush.net/michkap/archive/2007/07/11/3824400.html" mce_href="http://archives.miloush.net/michkap/archive/2007/07/11/3824400.html">Offense in depth</A> in response to Shawn's <A class="" href="http://blogs.msdn.com/shawnste/archive/2007/07/11/security-patch-breakes-some-culture-names-for-net-2-0-on-windows-xp-2003-2000.aspx" mce_href="http://blogs.msdn.com/shawnste/archive/2007/07/11/security-patch-breakes-some-culture-names-for-net-2-0-on-windows-xp-2003-2000.aspx">Security patch MS07-040 for .Net 2.0 breaks some culture names for .Net 2.0 on Windows XP/2003/2000</A>?</P>
<P>Well, as he later pointed out (in <A class="" href="http://blogs.msdn.com/shawnste/archive/2007/07/23/utf-16-utf-8-utf-32-update-to-conform-with-unicode-5-0-s-security-concerns.aspx" mce_href="http://blogs.msdn.com/shawnste/archive/2007/07/23/utf-16-utf-8-utf-32-update-to-conform-with-unicode-5-0-s-security-concerns.aspx">UTF-16, UTF-8 &amp; UTF-32 update to conform with Unicode 5.0's security concerns</A>), this change also includes the update that was done for the <A class="" href="http://blogs.msdn.com/shawnste/archive/2006/06/16/634666.aspx" mce_href="http://blogs.msdn.com/shawnste/archive/2006/06/16/634666.aspx">Change to Unicode Encoding for Unicode 5.0 conformance</A>&nbsp;that is currently being reported as the cause for problems like <A class="" href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=242830&amp;wa=wsignin1.0" mce_href="https://connect.microsoft.com/VisualStudio/feedback/ViewFeedback.aspx?FeedbackID=242830&amp;wa=wsignin1.0">Application.ExecutablePath cannot handle all characters</A> and others.</P>
<P>You can see some of this described in <A class="" href="http://support.microsoft.com/kb/940521/" mce_href="http://support.microsoft.com/kb/940521/">MSKB 940521</A>.</P>
<P>All of those problems have a single underlying cause.</P>
<P>and no I am not referring to the cause&nbsp;being the patch. :-)</P>
<P>That is why I said <STRONG>underlying</STRONG>. I am loojing for conceptual explanations, the kind that come up in RCA (Root Cause Analysis) conversations. Clasiming "the cause is the patch" in that context would just make you look foolish!</P>
<P>The unerlying cause is that whether you support the Unicode standard or not, whether you support the latest version or not, and whether you get the updates to managed/unmanaged code or not, <STRONG>not every piece of the underlying operating system supports this standard</STRONG>.</P>
<P>And that means that not everything that the OS can do is accessible to any method or function that changes Unicode encoding or normalization form.</P>
<P>In the one example feedback bug, for whatever crazy-ass reason, .NET does file/path stuff in UTF-8 in some part, perhaps shared code with some of the URI stuff? Whatever. But since they do that, there are pieces of the file system that are unavailable to some of their methods, in the name of security and conformance.</P>
<P>And so on, multiplied by&nbsp;potentially any&nbsp;managed (and in the future perhaps even some unmanaged?) entry points to developers to get their work done.</P>
<P>Personally, I think this is a bad idea.</P>
<P>I mean, there has to be an <STRONG>option</STRONG> to do these things. Obviously. The standard is there for&nbsp;a reason.</P>
<P>But do you tell a virus-checking program vendor that some files are not available to be scanned because they are not conformant to the Unicode standard, when they are legal in NTFS?</P>
<P>Due to a change in either a service pack or monthly security hotfix to the .NET Framework?</P>
<P>Ick.</P>
<P>In my opinion, there has to be a way to allow some of these things that were previously allowed to make sure such cases are not divorced from the realities that (a) the OS allows stuff and (b) the .NET Framework is as popular way to do stuff. These realities need to be cooperative, not competitive -- they&nbsp;must have a way to support each other, without thwarting each other.</P>
<P>Maybe people will decide this change had to happen. But I doubt everyone who was broken by it had the nature of the break communicated to them in time to do anything about it.</P>
<P>In the meantime, if you are a developer, please meet <A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>. You may well be seeing a lot more of him....</P>
<P mce_keep="true">&nbsp;</P>
<P><FONT color=#ff00ff><EM>This post brought to you by</EM> <FONT size=5>ï¿½</FONT> <EM>(<A class="" href="http://www.fileformat.info/info/unicode/char/fffd" mce_href="http://www.fileformat.info/info/unicode/char/fffd">U+fffd</A>, a.k.a. REPLACEMENT CHARACTER)</EM></FONT></P>
<hr/><p><a id="4953631" href="#4953631">#</a> <strong>William Overington</strong> on Monday, September 17, 2007 5:33 AM:</p><div style="margin-left: 1em"><p>Readers who are interested in trying to use U+FFFD with various packages, such as WordPad and Word and so on, might be interested to know that my Quest text font has a glyph for U+FFFD. &nbsp;The glyph is a large pixelated &quot;white&quot; question mark upon a &quot;black&quot; background.</p>
<p>I am using Windows xp. &nbsp;I tried Alt 65533 in WordPad and no glyph is displayed, though forward movement which may be that of a space character occurs. &nbsp;65533 is the decimal equivalent of the hexadecimal value FFFD. &nbsp;I used Insert Symbol with Word 97 and the glyph is displayed. &nbsp;I copied the character onto the clipboard and pasted back into Word 97. &nbsp;That works. &nbsp;I tried pasting into WordPad and that did not work.</p>
<p>In Word 97 I tried reformatting the U+FFFD character using various well-known fonts and all of those which I tried resulted in black rectangles.</p>
<p>The Quest text font is available as a free download from the following link.</p>
<p><a rel="nofollow" target="_new" href="http://www.users.globalnet.co.uk/~ngo/QUESTTXT.TTF">http://www.users.globalnet.co.uk/~ngo/QUESTTXT.TTF</a></p>
<p>The link and some notes about the font are available at the following web page.</p>
<p><a rel="nofollow" target="_new" href="http://www.users.globalnet.co.uk/~ngo/fonts.htm">http://www.users.globalnet.co.uk/~ngo/fonts.htm</a></p>
<p>There is a thread about the font at the following web page.</p>
<p><a rel="nofollow" target="_new" href="http://forum.high-logic.com/viewtopic.php?t=682">http://forum.high-logic.com/viewtopic.php?t=682</a></p>
<p>I mentioned the U+FFFD character in the fourth post in the following thread.</p>
<p><a rel="nofollow" target="_new" href="http://forum.high-logic.com/viewtopic.php?t=1102">http://forum.high-logic.com/viewtopic.php?t=1102</a></p>
<p>William Overington</p>
<p>17 September 2007</p></div>
<p><a id="4965628" href="#4965628">#</a> <strong>Dean Harding</strong> on Monday, September 17, 2007 7:32 PM:</p><div style="margin-left: 1em"><p>But is not the difference between &quot;before the update&quot; and &quot;after the update&quot; that instead of dropping invalid data, it replaces it with U+FFFD? In that case, wouldn't it mean that those &quot;valid in Win32 but not .NET&quot; paths would have still existed before the update?</p>
<p>What I mean is that before the update, the code would do the transform like so:</p>
<p>&quot;C:\\Hello\uD800World&quot; &nbsp;--&gt; &nbsp;&quot;C:\\HelloWorld&quot;</p>
<p>Whereas after the update, it would be:</p>
<p>&quot;C:\\Hello\uD800World&quot; --&gt; &quot;C:\\Hello\uFFFDWorld&quot;</p>
<p>So there was always the problem of not being able to access valid Win32 paths from .NET -- the problem is just a little different.</p>
<p>At least, that's how I read it....</p></div>
<p><a id="4967664" href="#4967664">#</a> <strong>Michael S. Kaplan</strong> on Monday, September 17, 2007 9:43 PM:</p><div style="margin-left: 1em"><p>Well, that is part of it (and a not entirely good part, IMHO) but really any invalid sequences get dropped as well (imagine non-shortest form UTF-8 and more from UT8 URIs, other invalid sequences in almost any encoding, etc.) -- and suddenly there is a disconnect between managed and unmanaged that once worked asny now doesn't, in a hotfix or an SP, etc.</p></div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2011/06/24 <a href="http://archives.miloush.net/michkap/archive/2011/06/24/10178528.html">An irresistible force walks into an immovable object (aka the Thai that binds us)</a></p><p>2010/11/01 <a href="http://archives.miloush.net/michkap/archive/2010/11/01/10083846.html">The consequences of being unintuitive and nonconformant</a></p><p>2008/11/13 <a href="http://archives.miloush.net/michkap/archive/2008/11/13/9065138.html">No need to throw out the baby with the streamwriter; they probably could have just put in a replacement</a></p><p>2008/05/11 <a href="http://archives.miloush.net/michkap/archive/2008/05/11/8488020.html">The vector of this spam is [apparently] indeterminate</a></p><p>2008/04/09 <a href="http://archives.miloush.net/michkap/archive/2008/04/09/8367652.html">Fight the Future? (#11 of ??), aka Microsoft is giving this character nada weight but lotsa importance</a></p><p>2007/10/23 <a href="http://archives.miloush.net/michkap/archive/2007/10/23/5617352.html">If working above U+FFFF is a problem n your program, then so is the basic stuff, too</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2007/09/17/4950277.html" title="The torrents of U+fffd (aka When security and conformance trump compatibility and reality)">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2007/09/17/4950008.html" title="A&amp;P of Sort Keys, part 7 (aka You&#39;re very thin now, but I can still recognize you)">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2007-09-17">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2007/09/17/4950277.204300.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:37 GMT -->
</html>