<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/01/10/511194.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>More on cursor support: the rest of the answer</title></head><body>
<h1>More on cursor support: the rest of the answer</h1>
<p><em>by Michael S. Kaplan, published on 2006/01/10 06:31 -08:00, original URI: http://blogs.msdn.com/michkap/archive/2006/01/10/511194.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>Ok, several people took up the challenge I suggested in <STRONG><a href="http://archives.miloush.net/michkap/archive/2006/01/09/510654.html">More on cursor support: in Bidi, intuition can be a four letter word</A></STRONG> once I gave a hint in <STRONG><a href="http://archives.miloush.net/michkap/archive/2006/01/09/510892.html">More on cursor support: half of the answer!</A></STRONG></FONT></P>
<P><FONT face=Tahoma>Before that, all of the guesses had been by email and none of them found five non-contiguous regions. I'll let that result speak for itself. :-)</FONT></P>
<P><FONT face=Tahoma>Here is the answer, graphically.</FONT></P>
<P><FONT face=Tahoma>Start with a left to right reading order, at the numbers on the left:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/Bidi01.jpg"></P>
<P><FONT face=Tahoma>Hold down the shift key and then start hitting the right arrow key:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/Bidi02.jpg"></FONT></P>
<P><FONT face=Tahoma>As soon as you cross the border from numbers to letters something interesting starts to happen:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/Bidi03.jpg"></P>
<P><FONT face=Tahoma>And then the next transition:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/Bidi04.jpg"></FONT></P>
<P><FONT face=Tahoma>You keep holding down the SHIFT key and continue hitting the right arrow key:</FONT></P>
<P><FONT face=Tahoma><IMG src="http://trigeminal.fmsinc.com/images/Bidi05.jpg"></FONT></P>
<P><FONT face=Tahoma>And finally you will hit that last bit:</FONT></P>
<P><IMG src="http://trigeminal.fmsinc.com/images/Bidi06.jpg"></P>
<P><FONT face=Tahoma>As Mihai <a href="http://archives.miloush.net/michkap/archive/2006/01/09/510892.html#510969">suggested</A>, this will not work if you have an RTL reading order set (though I think the appropriate string to work in the RTL context can be left as an exercise at this point!).</FONT></P>
<P><FONT face=Tahoma>And as Doug <a href="http://archives.miloush.net/michkap/archive/2006/01/09/510892.html#511024">suggested</A>, the secret here to get up to five is the "Bidi neutral" status of numbers (without the numbers, you can only get to three regions, I believe).</FONT></P>
<P><FONT face=Tahoma>The fact that this is the work of Uniscribe's "automatic" support in Windows is evident from Ben Bryant's <a href="http://archives.miloush.net/michkap/archive/2006/01/09/510892.html#510961">observation</A> that if you do not have extra language support installed, it will still work in Explorer but it will not work in Notepad. The reason for this is that clicking the checkbox to <EM>Install files for complex script and right-ro-left languages (including Thai)</EM> will enable the layer that causes all text to be evaluated by LPK.DLL to see if it should go through Uniscribe. It is actually an easy way to detect whether an application is calling Uniscribe directly or relying on the LPK.DLL support to have Uniscribe called automatically....</FONT></P>
<P><FONT face=Tahoma>Of course this is a rather contrived string, but the results, while seeming unintuitive to someone whose native language is not Hebrew, are really not entirely unexpected to a native speaker of a bidirectional language.</FONT></P>
<P><FONT face=Tahoma>As several people noted, this is not just in Notepad -- it is also happening in Windows Explorer, in IE, and in FireFox -- including on Linux. It is not due to&nbsp;developers trying to&nbsp;emulate MS platforms, but rather due to&nbsp;developers trying to work in the way that people who use the language would expect things to work. Even if it is confusing to people who do not work with bidirectional languages....</FONT></P>
<P><FONT face=Tahoma>As to the issue of <STRONG>why</STRONG> this is the expectation, I think it would be interesting to study the phenomenon here. <FONT face=Tahoma>When I think back to my past life as a neurodiagnostic technician, I think it would fascinating to actually use an electronystagmogram (ENG)&nbsp;machine to monitor eye movement while native and non-native speakers are reading bidirectional text; the results would likely be quite cool.</FONT></P>
<P><FONT face=Tahoma><EM>(don't worry people, I really don't have the equipment to start running those types of experiments; I did mention it was a past life!)</EM></FONT></P>
<P>The fact that the string is contrived does not mean that the behavior is unexpected -- a native speaker of English would have no problem describing how the yexpected the cursor to work in a document full of nonsense words, even if they were gibberish. Though it is true that Microsoft Word has options to alter both cursor movement and selection behavior that can make both more intuitive for non-native speakers:</P>
<P><IMG src="http://trigeminal.fmsinc.com/images/BidiWordDialog.jpg"></P>
<P>The description of these options is just an F1 away from this dialog:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE>
<H3>Cursor control</H3>
<P><B class=runinhead>Movement</B>&nbsp;&nbsp;&nbsp;Specifies Logical or Visual cursor movement. </P>
<UL>
<LI><FONT size=2><B class=runinhead>Logical</B>&nbsp;&nbsp;&nbsp;Sets insertion point movement to progress within bidirectional text according to the direction of the text encountered. For example, when using the arrow keys to move through Arabic and then English text in the same sentence, the arrow key moves from right to left through the Arabic text and then starts at the leftmost character in the English word and progresses from left to right. </FONT>
<LI><FONT size=2><B class=runinhead>Visual</B>&nbsp;&nbsp;&nbsp;Sets insertion point movement to progress within bidirectional text by moving to the next visually adjacent character. For example, when using the arrow keys to move from right to left through Arabic and then English text in the same sentence, the arrow key moves from right to left regardless of the direction of the text.</FONT></LI></UL>
<P><B class=runinhead>Visual selection</B>&nbsp;&nbsp;&nbsp;Specifies cursor movement.</P>
<UL>
<LI><FONT size=2><B class=runinhead>Block</B>&nbsp;&nbsp;&nbsp;Wraps text from line to line as you select downward, with all selected lines being the same width. </FONT>
<LI><FONT size=2><B class=runinhead>Continuous</B>&nbsp;&nbsp;&nbsp;Wraps text from line to line as you select downward and lets you vary the width of the final line of the block.</FONT></LI></UL></BLOCKQUOTE></BLOCKQUOTE>
<P>If you have Word you can actually try the "Movement"&nbsp;settings out to see what they do to your expectations, and whether the results make more sense or less to you. This way everyone gets to win, right? :-)</P>
<P><EM><FONT color=#ff0000>Addeddum 12 Jan 2006, sent by Mihai Nita</FONT></EM>:</P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px"><FONT size=2>
<P>Think that all lower-case characters are Hebrew characters, and this is the logical order (how they are stored in memory and how one would read them).&nbsp;<FONT color=#ff0000>RED</FONT> shows the selection at each step.</P>
<P></P>
<P><FONT face="Courier New"><STRONG>abc1<FONT color=#ff0000>23defABCghi45</FONT>6jkl</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>To display, we split this in text-runs with the same direction:</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>abc1<FONT color=#ff0000>23def</FONT> | <FONT color=#ff0000>ABC</FONT> | <FONT color=#ff0000>ghi45</FONT>6jkl</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>123 and 456 are numbers weak types and do not break the run.</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG></STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>Then we render each run according to it's rules. 1st one is RTL, 2nd LTR, 3rd RTL again:</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG><FONT color=#ff0000>fed32</FONT>1cba | <FONT color=#ff0000>ABC</FONT> | lkj6<FONT color=#ff0000>54igh</FONT></STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>The numbers in a RTL text are still rendered LTR, so we fix this:</STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG><FONT color=#ff0000>fed</FONT>1<FONT color=#ff0000>23</FONT>cba | <FONT color=#ff0000>ABC</FONT> | lkj<FONT color=#ff0000>45</FONT>6<FONT color=#ff0000>igh</FONT></STRONG></FONT></P>
<P><FONT face="Courier New"><STRONG>So here we have it, 5 selections, and all makes sense:</STRONG></FONT></P><FONT face="Courier New"><STRONG>
<P><FONT face="Courier New"><STRONG><FONT color=#ff0000>fed</FONT>1<FONT color=#ff0000>23</FONT>cba<FONT color=#ff0000>ABC</FONT>lkj<FONT color=#ff0000>45</FONT>6<FONT color=#ff0000>igh</FONT></STRONG></FONT></STRONG></FONT></P></FONT></BLOCKQUOTE></BLOCKQUOTE>
<P><FONT color=#ff1493><EM>This post brought to you by</EM> "<FONT size=6>ף</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/05e3">U+05e3</A>, a.k.a. HEBREW LETTER FINAL PE)</EM></FONT></P></FONT>
<hr/><p><a id="511198" href="#511198">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, January 10, 2006 9:42 AM:</p><div style="margin-left: 1em">Special thanks to Yaniv Feinberg for his help in coming up with the test string! :-)</div>
<p><a id="511272" href="#511272">#</a> <strong>Ben Bryant</strong> on Tuesday, January 10, 2006 1:15 PM:</p><div style="margin-left: 1em">Oh I was hoping you would explain why the 5 non-contiguous selection areas would make sense to anyone at all! Or is that something that takes too long to explain i.e. requires reading a book about the subject? I gather it is due to there being 3 different bidi status chars involved and the way the switching of direction can cause it to go and include from the beginning of the line, be it the &quot;beginning&quot; that is at the right or the one that is at the left... :) Actually I intend to implement bidi editing (hopefully this year sometime!) so I guess I will find out soon enough.</div>
<p><a id="511294" href="#511294">#</a> <strong>Mihai</strong> on Tuesday, January 10, 2006 1:53 PM:</p><div style="margin-left: 1em">&quot;(though I think the appropriate string to work in the RTL context can be left as an exercise at this point!)&quot;<br>My first intuition (the &quot;four letter word&quot;) is that it cannot be done.<br><br></div>
<p><a id="511336" href="#511336">#</a> <strong>Shoshannah Forbes</strong> on Tuesday, January 10, 2006 3:35 PM:</p><div style="margin-left: 1em">The experiment you are thinking about sounds really interesting- too bad it is your past life peeking :-)<br><br>I would like to note that as a native speaker, reading BIDI text like the example you gave is intuitive, even though it seems complex here. On the other hand, EDITING such text can be tricky sometimes- it isn't always obvious where the insertion point should be in order to add characters to the desired location, esp. if you start adding parenthesis into the mix.<br><br>In fact, I don't know anyone here (Israel) who doesn't  use the &quot;trial and error&quot; method on occasion to find the right location for the insertion point when editing complex bidi text (most common example: editing the source code of a Hebrew web page in a text editor. Arrrrg).<br><br>Anyway- great posts. Nice to see i18n people talking about BiDi. And don't get me started ranting about RTL UIs and the use of &quot;Left&quot; and &quot;Right&quot; instead of &quot;Before&quot; and &quot;After&quot; (or - systems where some open windows have RTL UI and some have LTR UI).</div>
<p><a id="511370" href="#511370">#</a> <strong>Michael S. Kaplan</strong> on Tuesday, January 10, 2006 4:56 PM:</p><div style="margin-left: 1em">Mihai --<br><br>My knowledge source originally thought there was a solution that could provide *seven* non-contiguous areas! But he scaled back eventuaslly....<br><br>An RTL sentence that will do the same thing is indeed supposed to be possible.</div>
<p><a id="511443" href="#511443">#</a> <strong>Mihai</strong> on Tuesday, January 10, 2006 9:20 PM:</p><div style="margin-left: 1em">-- MisKa --<br>I guess it takes some years of really using RTL languages to get the intuition work right, so I would not be sourprised :-)<br><br>-- For Ben --<br>I will try a short explanation for the why part, very-very simplified. You can check the Unicode BiDi Algorithm for the real deal (<a rel="nofollow" target="_new" href="http://www.unicode.org/reports/tr9">http://www.unicode.org/reports/tr9</a>) <br><br>This will be more visible with fixed width fonts, so copy/paste in Notepad/Word and select a fixed font.<br><br>Think that all lower-case characters are hebrew characters, and this is the logical order (how they are stored in memory and how one would read them). ~ shows the selection<br><br>abc123defABCghi123jkl<br>    ~~~~~~~~~~~~~<br><br>To display, we split this in text-runs with the same direction:<br>abc123def | ABC | ghi123jkl<br>    ~~~~~   ~~~   ~~~~~<br>123 are numbers weak types and do not break the run.<br><br>Then we render each run according to it's rules. 1st one is RTL, 2nd LTR, 3rd RTL again:<br>fed321cba | ABC | lkj321igh<br>~~~~~       ~~~       ~~~~~<br><br>The numbers in a RTL text are still rendered LTR, so we fix this:<br>fed123cba | ABC | lkj123igh<br>~~~ ~~      ~~~      ~~ ~~~<br><br>So here it is, 5 selections, and all makes sense:<br>fed123cbaABClkj123igh<br>~~~ ~~   ~~~   ~~ ~~~<br></div>
<p><a id="511460" href="#511460">#</a> <strong>Mihai</strong> on Tuesday, January 10, 2006 11:35 PM:</p><div style="margin-left: 1em">Sorry, the explanation is totally messed up. The submission form collapsed the multiple spaces to one space only, so the alignment is wrong even with fixed width fonts :-(<br>I will try to post this somewhere else, with a link to and from here.<br></div>
<p><a id="511480" href="#511480">#</a> <strong>Michael S. Kaplan</strong> on Wednesday, January 11, 2006 1:10 AM:</p><div style="margin-left: 1em">Ah, no worries -- you can also mail it to me if you want and I'll post it....</div>
<p><a id="511570" href="#511570">#</a> <strong>Nick Lamb</strong> on Wednesday, January 11, 2006 10:14 AM:</p><div style="margin-left: 1em">It's easier to understand what's going on with a better example. Begin the string with English text (so that people implementing UAX #9 P3 detect it as an LTR paragraph) then use 123/456 rather than 123/123 and use nine different Hebrew characters rather than the same three repeated.<br><br>This makes it obvious that your selection is just a contiguous series of characters throughout, and re-ordering is done for display as required by UAX #9. As observed by one of your posters, this selection exists regardless of the cursor movement rules, but the means to achieve it differs if you use the keyboard.<br><br>Unfortunately this series of posts doesn't really seem to address my earlier comments, except the mention of Word having support for visual cursor movement hidden away. You also mentioned Firefox and Linux, apparently without realising that they both implement visual cursor movement.<br><br>For clarity: The Unicode BiDi Algorithm does not specify cursor movement. Specifications which seem more comprehensive than Unicode (while not contradicting it) such as IBM's, specify visual cursor movement as the preferred or only mechanism as well as a secondary hint cursor and other things not (yet) implemented by Windows.</div>
<p><a id="511577" href="#511577">#</a> <strong>Universalis</strong> on Wednesday, January 11, 2006 10:36 AM:</p><div style="margin-left: 1em">Thank you for explaining what LPK.DLL is - I was wondering why DrawTextW(,L&quot;Crash&amp;&quot;,6,,) sometimes crashed and sometimes didn't. It's down to LPK intercepting DrawTextW and passing the string on to Uniscribe and Uniscribe (USP10.DLL) scanning the string and trying to look beyond the final ampersand (since DT_NOPREFIX was not specified). If the string happens to be allocated at the end of a page then  the result is a crash as USP10 reads unallocated memory.<br><br>On non-complex-script installations LPK doesn't interfere, and there's no crash because the real live Windows DrawTextW doesn't have this bug.<br><br>I don't think Unicows has the bug either. Perhaps it should be added, for compatibility with the latest Windows implementation...</div>
<p><a id="511640" href="#511640">#</a> <strong>Michael S. Kaplan</strong> on Wednesday, January 11, 2006 12:20 PM:</p><div style="margin-left: 1em">Hi Nick --<br><br>Your suggested improvment would actually cause there to not be those five non-contiguous areas, though perhaps a modified version of it could be used. I am pretty sure that this example is clear enough for the point to be understood.<br><br>I understand that you believe the MS implementation is a legacy thing and that the IBM visual solution is preferred. At this point I guess we will have to agree to disagree, though it is worth noting that generally speasking I think you will find that native speakers do not agree with you.<br><br>I am always willing to be wrong and admit I am, but when native speakers agree with me, I will assume that I am right? :-)</div>
<p><a id="511702" href="#511702">#</a> <strong>Nick Lamb</strong> on Wednesday, January 11, 2006 2:15 PM:</p><div style="margin-left: 1em">Hmm, it works fine here, the sample string I'm using is<br><br>This אבג123דהוABCזחט456יכל works fine for me<br><br>Since blogs.msdn.com seems to have various problems I'll also include instructions on how to enter this yourself (but I assume you know how to enter Hebrew characters even if only by typing their Unicode codepoint)<br><br>1. Type &quot;This&quot; followed by a space<br>2, Then type Alef, Bet, Gimel, the first three characters of the Hebrew alphabet<br>3. Type &quot;123&quot;<br>4. Now the next three Hebrew characters<br>5. And now &quot;ABC&quot;<br>6. Then the next three Hebrew characters<br>7. And &quot;456&quot;<br>8. Finally type Yod, Kaf, Lamed<br>9. Type a space followed by &quot;works fine for me&quot;<br><br>You can select the range from between 2-3 and 4-5 to see the five non-contiguous areas as before.<br><br>It's still nonsense, but now anyone can recognise the re-ordering rules in operation.<br><br>Michael, if this doesn't work for you it may be because of a bug, please describe the problem further.</div>
<p><a id="511820" href="#511820">#</a> <strong>Michael S. Kaplan</strong> on Wednesday, January 11, 2006 7:04 PM:</p><div style="margin-left: 1em">Ah, this would work,I had something different in mind here....</div>
<p><a id="515446" href="#515446">#</a> <strong>Uri Bernstein</strong> on Friday, January 20, 2006 2:05 PM:</p><div style="margin-left: 1em">I'm a bit late to discover this post (and this blog), but for the record: I'm a native speaker (and writer) of Hebrew, and I strongly prefer &quot;visual&quot; caret movement (and selection).<br>The catch is that visual caret movement is much more difficult to specify and implement (due to the interaction with logical typing and deleting), so some of the existing implementations are still buggy in this way or another. I believe that this, along with the fact that most people became used to working with Microsoft products (which use logical caret movement), is the reason that many people claim to prefer logical movement.</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2012/10/09 <a href="http://archives.miloush.net/michkap/archive/2012/10/09/10357645.html">It is quite ironic to call it 'Logical' if no one really knows what to do with it!</a></p><p>2008/10/06 <a href="http://archives.miloush.net/michkap/archive/2008/10/06/8977552.html">UCS-2 to UTF-16, Part 4: Talking about the ask</a></p><p>2006/02/07 <a href="http://archives.miloush.net/michkap/archive/2006/02/07/526359.html">If the text is not complex, does it have to be treated like it is?</a></p><p>2006/01/19 <a href="http://archives.miloush.net/michkap/archive/2006/01/19/514718.html">What are directional marks -- chumps who point?</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/01/10/511428.html" title="SIAO -- where lies become truth!">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/01/09/510892.html" title="More on cursor support: half of the answer!">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-01">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-01-10">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/01/10/511194.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:40 GMT -->
</html>