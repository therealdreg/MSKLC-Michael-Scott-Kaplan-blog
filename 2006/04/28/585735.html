<html>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/28/585735.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
<head><meta charset="utf-8" /><meta name="viewport" content="width=device-width" /><title>DEFAULT_GUI_FONT really stinks</title></head><body>
<h1>DEFAULT_GUI_FONT really stinks</h1>
<p><em>by Michael S. Kaplan, published on 2006/04/28 00:01 -07:00, original URI: http://blogs.msdn.com/michkap/archive/2006/04/28/585735.aspx</em></p>
<hr/> <!-- Archival Source: ProcessPostOld -->
<P><FONT face=Tahoma>You don't want to ever use DEFAULT_GUI_FONT. Just like the <A href="http://archives.miloush.net/michkap/archive/2005/08/22/454360.html"><STRONG>thread locale</STRONG></A>, <A href="http://archives.miloush.net/michkap/archive/2005/04/13/407912.html"><STRONG>AVICAP32.DLL</STRONG></A>, and <A href="http://archives.miloush.net/michkap/archive/2005/04/23/411074.html"><STRONG>SetLocaleInfo</STRONG></A>, it really stinks.</FONT></P>
<P><FONT face=Tahoma>Raymond Chen talked about some of its history of this <A href="http://msdn.microsoft.com/library/en-us/gdi/devcons_1t10.asp">GetStockObject</A> derived font last year when he answered the question <A href="http://blogs.msdn.com/oldnewthing/archive/2005/07/07/436435.aspx">What are SYSTEM_FONT and DEFAULT_GUI_FONT?</A></FONT></P>
<P><FONT face=Tahoma>He even explained one of the big problems about it in international scenarios:</FONT></P>
<BLOCKQUOTE dir=ltr style="MARGIN-RIGHT: 0px">
<P><FONT face="Times New Roman" size=2>"...on a typical US-English machine, they map to bitmap fonts that do not support ClearType."</FONT></P></BLOCKQUOTE>
<P><FONT face=Tahoma>But beyond that, there is another big problem.&nbsp;The problem&nbsp;is that the actual font it resolves to is SKU dependent; it is not dependent on any of the various locale settings on the machine. It therefore becomes one of those "features" that keeps an MUI system with a changed system/user locale from being a 100% substitution for a localized system in testing.</FONT></P>
<P><FONT face=Tahoma>And even in Vista, where the single world wide binary goal has really been largely achieved, the backcompat issues that come up with (for example)&nbsp;a Korean&nbsp;user who expects a particular legacy application's font settings to not change disallow 'fixing' this behavior. So we are stuck with this bit of cruft that will forever differentiate some particular language SKUs of what is otherwise a SWWB model system....</FONT></P>
<P><FONT face=Tahoma>Don't forget that as Raymond talked a bit about, all of the <A href="http://msdn.microsoft.com/library/en-us/gdi/devcons_1t10.asp">GetStockObject</A>&nbsp;derived fonts are no longer what the help topic claims to be -- they are not used by the system for anything, and remain only for the sake of applications that have depended on these ugly beasts.</FONT></P>
<P><FONT face=Tahoma>So please stay away from DEFAULT_GUI_FONT; it stinks, truly!</FONT></P>
<P><FONT face=Tahoma></FONT>&nbsp;</P>
<P><FONT face=Tahoma color=#ff1493><EM>This post brought to you by</EM> "<FONT face="Times New Roman" size=6>ᇸ</FONT>" <EM>(<A href="http://www.fileformat.info/info/unicode/char/11f8">U+11f8</A>, a.k.a. HANGUL JONGSEONG HIEUH-PIEUP)</EM></FONT></P>
<hr/><p><a id="585864" href="#585864">#</a> <strong>Christian Kaiser</strong> on Friday, April 28, 2006 4:00 AM:</p><div style="margin-left: 1em">Sorry, I guess it is mentioned somewhere long ago - what is the CORRECT way to get a font for user interaction then?<br><br>MS Shell Dlg?<br>MS Shell Dlg2?<br>...?<br><br>(I mean, independent in the Windows version, starting (in my case) Win98 and NT4).<br><br>Christian<br></div>
<p><a id="585870" href="#585870">#</a> <strong>Manuel</strong> on Friday, April 28, 2006 4:15 AM:</p><div style="margin-left: 1em">Hello, has straight time and looks around into English speaking Blogs in such a way. &nbsp;To arrange Holle me suggestions around also German Blogs. &nbsp;Unfortunately there is not as clasp-rich Blogs in Europe as English until soon and tschuess Manuel</div>
<p><a id="585873" href="#585873">#</a> <strong>Michael S. Kaplan</strong> on Friday, April 28, 2006 4:25 AM:</p><div style="margin-left: 1em">Hi Christian -- this is a topic of an upcoming post (and for most people it is not MS Shell Dlg, as I mentioned already, in another post). :-)<br><br>Hi Manuel -- I'm sorry, I don't know what kind of blog you are looking for? It makes giving advice on a German blog dificult....</div>
<p><a id="585998" href="#585998">#</a> <strong>Ted.</strong> on Friday, April 28, 2006 9:12 AM:</p><div style="margin-left: 1em">It could be a nice article, except for the fact that it's not true. &nbsp;DEFAULT_GUI_FONT maps to MS Shell Dlg which in turn maps to Microsoft Sans Serif in any US English non-customized XP machine. <br><br>Last time I checked Microsoft Sans Serif is Cleartype open. &nbsp;<br><br>And if DEFAULT_GUI_FONT was truly evil and support for it was somehow changed or deprecated then millions of shipping apps would break, that would be something very un-Chen. &nbsp; <br></div>
<p><a id="586023" href="#586023">#</a> <strong>Michael S. Kaplan</strong> on Friday, April 28, 2006 10:36 AM:</p><div style="margin-left: 1em">Hi Ted,<br><br>I'm sorry, but you are mistaken -- especially on CJK machines, where DEFAULT_GUI_FONT is decidedly *not* MS Shell Dlg, and explicitly chosen by the SKU language.<br><br>This is especially bad in Vista, given the independence from SKU that has otherwise been acheived.....</div>
<p><a id="586063" href="#586063">#</a> <strong>Ted.</strong> on Friday, April 28, 2006 12:07 PM:</p><div style="margin-left: 1em">Read what I said - run this on any XP US English machine (this is C++ code):<br><br>LOGFONT logFont;<br>GetObject(GetStockObject (DEFAULT_GUI_FONT),sizeof(logFont), &amp;logFont ); <br><br>and look the results in the debugger. &nbsp;<br></div>
<p><a id="586133" href="#586133">#</a> <strong>Ted.</strong> on Friday, April 28, 2006 1:06 PM:</p><div style="margin-left: 1em">The only point I was trying to make was that this statement: &quot;...on a typical US-English machine, they map to bitmap fonts that do not support ClearType.&quot; is not true for DEFAULT_GUI_FONT. &nbsp;It is true, I concede, for SYSTEM_FONT. &nbsp; DEFAULT_GUI_FONT maps to a ClearType font on a typical US-English machine. &nbsp; &nbsp; This one statement is all that ruins such a good article. &nbsp;<br><br>Other than that, yes, your article makes some valid points. &nbsp;I do agree that DEFAULT_GUI_FONT is an unfortunate part of Windows history that we'll have to live with for a long time (as every MFC app ever built uses it for dialog box fonts on DBCS systems - see CDialogTemplate::SetSystemFont)</div>
<p><a id="586212" href="#586212">#</a> <strong>Michael S. Kaplan</strong> on Friday, April 28, 2006 2:49 PM:</p><div style="margin-left: 1em">Ok, that makes sense. :-)&nbsp; <BR><BR>Of course I was just quoting that piece -- I am much more bothered about the SWWB problem and the fact that no piece of the system uses these any more even though the docs claim they still do....</div>
<p><a id="586768" href="#586768">#</a> <strong>charless</strong> on Saturday, April 29, 2006 1:08 PM:</p><div style="margin-left: 1em">Michael,<br> &nbsp; &nbsp;Having actually worked on a consumer program that shipped as a SWWB, I have run into this issue more than once. It seems to me that making DEFAULT_GUI_FONT really return what the documentation claims would be a good thing, in most cases. As it is now, if you needed to programatically draw a window that looked like a dialog box and you used DEFAULT_GUI_FONT to do the computations to get from dialog units to screen units. You would end up not only with the font looking wrong, but the aspect ration of the dialog wrong as well. I am sure that making such a change would cause many existing apps to differently. In some cases differnt would be bad/worse than now, but I believe in some cases it would be better/more correct than it is now.<br><br> &nbsp; &nbsp;In any case I think the comments on Raymond's post show that the MSDN article for GetStockObject really needs to be updated to explain the issues and some sample code to do this the 'correct' way. If the behavior is not changed, it seems like it would be advisable to add a way to set what font returned. (at least for developers) e.g. a registry setting and a PowerToy to pick it.<br><br>-charles</div>
<p><a id="586834" href="#586834">#</a> <strong>Michael S. Kaplan</strong> on Saturday, April 29, 2006 3:42 PM:</p><div style="margin-left: 1em">It is actually a very sad thing that these various solutions are tied to specific fonts. I plan on posting soon on why that is and why it probably will continue to be so....</div>
<p><a id="586892" href="#586892">#</a> <strong>George</strong> on Saturday, April 29, 2006 6:23 PM:</p><div style="margin-left: 1em">So we shouldn't use MS Shell Dlg according to your other post.<br><br>And we shouldn't use DEFAULT_GUI_FONT according to this post.<br><br>Add me to the growing list of readers who wants to know what we should use here!</div>
<p><a id="588187" href="#588187">#</a> <strong>Dean Harding</strong> on Tuesday, May 02, 2006 3:00 AM:</p><div style="margin-left: 1em">As to what to use instead of DEFAULT_GUI_FONT or MS Shell Dlg, you should be using the various fonts returned by SystemParametersInfo. Different parts of the UI can have different fonts (to illustrate, right-click on the desktop and go Properties, then change the various fonts under Appearance-&gt;Advanced).<br><br>In .NET, you should be using the SystemFonts class to get the various fonts for the different parts of the UI. (which is essentially the same thing). It's a shame that WinForms doesn't automatically set the Form's font to SystemFonts.IconTitleFont (which is usually Tahoma) but I believe there was a backcompat issue between .NET 1.1 and .NET 2 which means they can't change it...</div>
<hr/><p><em>referenced by</em></p><div style="margin-left: 1em"><p>2008/08/14 <a href="http://archives.miloush.net/michkap/archive/2008/08/14/8867856.html">SYSTEM_FONT hasn't been the system font since Reagan's first term in the White House</a></p><p>2006/06/11 <a href="http://archives.miloush.net/michkap/archive/2006/06/11/626100.html">Why the Windows Shell can't provide the ultimate font solution for everyone (or even anyone!)</a></p><p>2006/06/06 <a href="http://archives.miloush.net/michkap/archive/2006/06/06/618628.html">Is this the Über-font post? No, but it is the teaser for it!</a></p><p>2006/05/05 <a href="http://archives.miloush.net/michkap/archive/2006/05/05/590504.html">UI language of the LocalSystem account (which almost never shows UI)</a></p><p>2006/05/01 <a href="http://archives.miloush.net/michkap/archive/2006/05/01/587340.html">A bit about the 'Single World Wide Binary'</a></p></div><p><em>go to <a id="newer" href="http://archives.miloush.net/michkap/archive/2006/04/29/586726.html" title="&#39;Which comes first?&#39; vs. &#39;Are they equal?&#39;">newer</a> or <a id="older" href="http://archives.miloush.net/michkap/archive/2006/04/27/585169.html" title="Stay ahead of the culture by creating the culture">older</a> post, or back to <a href="http://archives.miloush.net/michkap/archive/index.html">index</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04">month</a> or <a href="http://archives.miloush.net/michkap/archive/index.html#2006-04-28">day</a></em></p></body>
<!-- Mirrored from archives.miloush.net/michkap/archive/2006/04/28/585735.html by HTTrack Website Copier/3.x [XR&CO'2014], Thu, 25 May 2017 00:42:39 GMT -->
</html>